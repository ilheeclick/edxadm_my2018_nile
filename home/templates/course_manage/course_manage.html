{% extends "container/main_base.html" %}
{% block pagetitlename %}강좌 관리{% endblock %}
{% block pagetitlename_header %}강좌 관리{% endblock %}
{% block script_down %}
<link rel="stylesheet" href="//code.jquery.com/ui/1.8.18/themes/base/jquery-ui.css" />
<script>

jQuery.ajaxSettings.traditional = true;
    $(document).ready(function() {
        setDataTable1();
    });


    function setDataTable1() {
        var $table = $('#datatable1');

        $table.dataTable({
            "scrollY": "400px",
            "scrollX": "400px",
			bProcessing: true,
			rowReorder: false,
            "searching": false,
			sAjaxSource: $table.data('url'),
			"fnReloadAjax": true,
			"fnServerParams": function ( data ) {
                var choice = document.getElementById("choice");
                data.push({ "name": 'method', "value": 'course_list'});
                data.push({ "name": 'start', "value": $('#datepicker1').val()});
                data.push({ "name": 'end', "value": $('#datepicker2').val()});
                data.push({ "name": 'course_name', "value": $('#course_name').val()});
                data.push({ "name": 'choice', "value": choice.options[choice.selectedIndex].value});
			},


			dom: '<"toolbar"><"search"B>rt<"bottom"ip><"clear">',

			"paginate": false,
			"columnDefs":[
                {
                    targets: 0, visible: true, name: "pk", render: function (data, type) {
                    return '<input type="checkbox" name="' + undefined + '" value="' + undefined + '">';
                }, width: '3%'
                },
                {
                    targets: 3, visible: true, render: function (data, type) {
                    return '<select style="width:90px" id="choice_1" class="form-control"><option value="001">개발유형1</option><option value="002">개발유형2</option><option value="003">개발유형3</option></select>';
                },
                },
                {
                    targets: 4, visible: true, render: function (data, type) {
                    return '<select style="width:60px" id="choice_2" class="form-control"><option value="2015">2015</option><option value="2016">2016</option><option value="2017">2017</option></select>';
                },
                },
                { targets: 2, visible: false},
                { targets: 5, visible: false},
                { targets: 6, visible: false},
                { targets: 20, visible: false},
                { targets: 21, visible: false},
                { targets: 22, visible: false},
                { targets: 23, visible: false},
                { targets: 24, visible: false},
                { targets: 25, visible: false},

                { targets: 6, width:'8%'},
                { targets: 12, width:'10%'},
                { targets: 17, width:'15%'},

			],

            buttons: [
                {
                    extend: 'excelHtml5',
                    exportOptions: {
                    columns: [1,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]
                    },
                    text: 'Excel',
                    filename: $("#pagetitle").text() + '-강좌관리',
                }
            ],

			"initComplete": function(settings, json){
                $('.buttons-html5').attr('class', 'btn btn-primary');
                $('input[type="checkbox"]').css("float","right");
			}
		});
    }

    $.datepicker.setDefaults({
    dateFormat: 'yy-mm-dd',
    prevText: '이전 달',
    nextText: '다음 달',
    monthNames: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
    monthNamesShort: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
    dayNames: ['일', '월', '화', '수', '목', '금', '토'],
    dayNamesShort: ['일', '월', '화', '수', '목', '금', '토'],
    dayNamesMin: ['일', '월', '화', '수', '목', '금', '토'],
    showMonthAfterYear: true,
    yearSuffix: '년'
  });

  $(function() {
    $("#datepicker1, #datepicker2").datepicker();
  });


    function checked_all() {
        console.log($("#check_all").is(":checked"));

        if ($("#check_all").is(":checked")) {
            $("#datatable1 tbody input[type=checkbox]:visible").prop("checked", true);
        } else {
            $("#datatable1 tbody input[type=checkbox]:visible").prop("checked", false);
        }
    }

    function search() {
        var table = $('#datatable1').DataTable();
        table.ajax.reload();
    }

    function Save() {
        var $row;
        var data;
        var choice1;
        var choice2;
        var t = $('#datatable1').DataTable();
        var course_id = '';
        var choice1_list = '';
        var choice2_list = '';

        $("#notice_body input[type=checkbox]:checked").each(function() {

            $row = $(this).closest('tr');
            data = t.row($row.get(0)).data();
            choice1 = $(this).parent().next().next().find("select").val();
            choice2 = $(this).parent().next().next().next().find("select").val();

            course_id += data[2] + "$";
            choice1_list += choice1 + "$";
            choice2_list += choice2 + "$";
        });

        $.post("/manage/course_db/", {
            csrfmiddlewaretoken: $.cookie('csrftoken'),
            user_id: '{{ user.id }}',
            course_id: course_id,
            choice1_list: choice1_list,
            choice2_list: choice2_list,
            method: 'add',
        }).done(function (data) {
            search();
        }).fail(function (error) {
            swal("경고", "이미 추가된 강좌가 존재합니다.", "warning");
        });
    }
    function Del() {
        var $row;
        var data;
        var choice1;
        var choice2;
        var t = $('#datatable1').DataTable();
        var course_id = '';

        $("#notice_body input[type=checkbox]:checked").each(function() {

            $row = $(this).closest('tr');
            data = t.row($row.get(0)).data();
            choice1 = $(this).parent().next().next().find("select").val();
            choice2 = $(this).parent().next().next().next().find("select").val();

            course_id += data[2] + "$";
        });

        $.post("/manage/course_db/", {
            csrfmiddlewaretoken: $.cookie('csrftoken'),
            user_id: '{{ user.id }}',
            course_id: course_id,
            method: 'del',
        }).done(function (data) {
            search();
        }).fail(function (error) {
            swal("경고", "이미 추가된 강좌가 존재합니다.", "warning");
        });
    }
</script>
{% endblock %}
{% block containor %}
	<!-- start: page -->
<section class="panel panel-featured ">
    <header class="panel-heading">
        <div><h2 class="panel-title">강좌 관리</h2></div>
    </header>

    <div class="panel-body" style="padding-top: 0;"> 
        <div class="row">
            <a href="javascript:search();" align="right"><input class="btn btn-primary" type="button" id="searchBtn" value="검  색"></a>
            <div class="col-sm-2">
                <div class="form-group">
                    <select id="choice" class="form-control">
                        <option value="">선택하세요.</option>
                        <option value="1">수강신청 시작일, 종료일</option>
                        <option value="2">개강일, 종강일</option>
                    </select>
                </div>
            </div>

            <div class="col-sm-2">
                <div class="form-group">
                    <input type="text" id="datepicker1" class="form-control"><span class="fa fa-calendar fa-2x"/>
                </div>
            </div>

            <div class="col-sm-2">
                <div class="form-group">
                    <input type="text" id="datepicker2" class="form-control"><span class="fa fa-calendar fa-2x"/>
                </div>
            </div>

        </div>

        <div class="row">
            <div class="col-sm-2">
                <div class="form-group">
                    <label class="control-label">강좌명</label>
                    <input type="text" id="course_name" class="form-control">
                </div>
            </div>
        </div>
    <div class="row">

    </div>
        <a href="javascript:Del();" style="float:right; margin:0px 30px 0px 5px"><input class="btn btn-default" type="button" value="삭 제"></a>
        <a href="javascript:Save();" style="float:right;"><input class="btn btn-primary" type="button" value="저 장"></a>
        <br>
        <br>


        <table class="table table-hover table-striped  table-bordered" data-url="/manage/course_db_list/" id="datatable1"  >
            <thead>
                <tr>
                    <td><input type="checkbox" onclick="checked_all()" id="check_all"/></td>
                    <td>NO</td>
                    <td>ID</td>
                    <td>개발유형</td>
                    <td>개발년도</td>
                    <td>_개발유형</td>
                    <td>_개발년도</td>
                    <td>대학명</td>
                    <td>대분류</td>
                    <td>중분류</td>
                    <td>강좌명</td>
                    <td>기관번호</td>
                    <td>강좌번호</td>
                    <td>강좌별운영번호</td>
                    <td>상태</td>
                    <td>개설일</td>
                    <td>수강신청시작일</td>
                    <td>수강신청마감일</td>
                    <td>종강일</td>
                    <td>이수증생성일</td>
                    <td>교수자</td>
                    <td>동영상재생시간</td>
                    <td>주간학습권장시간</td>
                    <td>총주차</td>
                    <td>총학습시간</td>
                    <td>강좌수준</td>
                </tr>
            </thead>
            <tbody id="notice_body">
            </tbody>
        </table>
    </div>
</section>


{% endblock %}